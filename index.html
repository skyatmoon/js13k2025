<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport"content="width=device-width, initial-scale=1.0"><title>A Hungry Black</title><style>body{margin:0;padding:0;overflow:hidden;background:#fff;color:#000;font-family:Arial,sans-serif}.startPage{position:fixed;top:0;left:0;width:100%;height:100%;background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:1000}.gameTitle{font-size:5vw;margin-bottom:5vh;color:#000;text-shadow:2px 2px 4px rgba(0,0,0,0.3)}.startPageButton{padding:1.5vh 3vw;font-size:2vw;background:#000;color:#fff;border:none;border-radius:5px;cursor:pointer;transition:all 0.3s ease}.startPageButton:hover{background:#333;transform:scale(1.05)}.fishBackground{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1;pointer-events:none}.fish{position:absolute;width:2vw;height:1.2vw;background:#000;border-radius:50%50%50%50%/60%60%40%40%}.fish::before{content:'';position:absolute;right:-0.6vw;top:50%;transform:translateY(-50%);width:0.8vw;height:1vw;background:#000;border-radius:50%0 0 50%}.fish::after{content:'';position:absolute;left:-0.2vw;top:50%;transform:translateY(-50%);width:0.4vw;height:0.4vw;background:#000;border-radius:50%}.gameContainer{position:fixed;top:0;left:0;width:100%;height:100%;background:#fff;display:none;flex-direction:column;align-items:center;justify-content:center;z-index:2000;opacity:0;transition:opacity 0.5s ease}.gameContainer.show{display:flex;opacity:1}.gameContent{position:relative;display:flex;width:90vw;height:80vh;max-width:90vw;max-height:80vh;flex-shrink:0}.gameTutorial{width:25%;min-width:20vw;padding:2vw;background:rgba(255,255,255,0.9);border-radius:2vw;margin-right:2vw;overflow-y:auto;box-shadow:0 2vw 10vw rgba(0,0,0,0.1);flex-shrink:0}.gameTutorial h3{font-size:1.8vw;margin-top:0;margin-bottom:1.5vh}.gameTutorial ul{margin:0;padding-left:1.5vw}.gameTutorial li{margin-bottom:1vh;line-height:1.4;font-size:1.2vw}.gameCanvasContainer{flex:1;min-width:30vw;background:rgba(255,255,255,0.9);border-radius:2vw;display:flex;align-items:center;justify-content:center;position:relative;box-shadow:0 2vw 10vw rgba(0,0,0,0.1);padding:2vw}#gameCanvas{width:100%;height:100%;background:#f0f0f0;border-radius:5px;position:relative;z-index:5}.backButton{position:absolute;top:2vh;left:2vw;padding:1.5vh 3vw;font-size:2vw;background:#000;color:#fff;border:none;border-radius:5px;cursor:pointer;transition:all 0.3s ease;z-index:10}.backButton:hover{background:#333;transform:scale(1.05)}.gameMessage{font-size:3vw;color:#000;text-align:center;margin-bottom:5vh}</style></head><body><!--Home Page--><div class="startPage"><h1 class="gameTitle">A Hungry Black</h1><div style="margin-bottom: 3vh;"><label for="playerName"style="font-size: 1.5vw; display: block; margin-bottom: 1vh;">Enter your name:</label><input type="text"id="playerName"placeholder="player"style="padding: 1vh 2vw; font-size: 1.5vw; border: 2px solid #000; border-radius: 5px; text-align: center;"maxlength="10"></div><button class="startPageButton">Start Game</button><div class="fishBackground"></div></div><!--Game Container--><div class="gameContainer"><div class="fishBackground"></div><button class="backButton">Back Home</button><button id="musicToggle"style="position: absolute; top: 2vh; left: 22vw; padding: 1.5vh 2vw; font-size: 2vw; background: #000; color: #fff; border: none; border-radius: 5px; cursor: pointer; transition: all 0.3s ease; z-index: 10;">ðŸ”Š</button><div class="gameContent"><div class="gameTutorial"><h3>Game Tutorial</h3><ul><li><strong>Basic Controls:</strong>Drag the mouse to move the black cat in the direction you want to go</li><li><strong>Touch Controls:</strong>Drag your finger across the screen on mobile devices</li><li><strong>Red Arrow:</strong>Indicates the direction your cat is moving</li><li><strong>Growing:</strong>Eat smaller enemies and food to increase your size</li><li><strong>Survival:</strong>Avoid enemies larger than you(10%bigger or more)</li><li><strong>Goal:</strong>Grow your size until your diameter exceeds the map width(2000)to win the game!</li></ul><h3 style="margin-top: 2vh;">Enemy Types</h3><div style="display: flex; flex-direction: column; gap: 1vh;"><div style="display: flex; align-items: center; gap: 1vw;"><div style="width: 1.5vw; height: 1.5vw; border-radius: 50%; background: #8B4513;"></div><span style="font-size: 1.2vw;">Dog Balls(Brown)</span></div><div style="display: flex; align-items: center; gap: 1vw;"><div style="width: 1.5vw; height: 1.5vw; border-radius: 50%; background: #444444;"></div><span style="font-size: 1.2vw;">Mouse Balls(Dark Gray)</span></div><div style="display: flex; align-items: center; gap: 1vw;"><div style="width: 1.5vw; height: 1.5vw; border-radius: 50%; background: #FF69B4;"></div><span style="font-size: 1.2vw;">Cat Balls(Pink)</span></div></div><h3 style="margin-top: 2vh;">Predator-Prey Relationships</h3><ul><li><strong>Black Cat(You)</strong>can eat:Smaller dog balls,mouse balls,and cat balls</li><li><strong>Dog Balls</strong>will chase:Smaller mouse balls and cat balls</li><li><strong>Mouse Balls</strong>will avoid:Larger dog balls and cat balls</li><li><strong>Cat Balls</strong>will chase:Smaller mouse balls and dog balls</li><li>All enemies will try to avoid being eaten by larger balls</li></ul><h3 style="margin-top: 2vh;">Tips</h3><ul><li>Start by eating small food items to grow safely</li><li>Use the red arrow to confirm your movement direction</li><li>Watch out for enemies that suddenly change direction</li><li>Remember:Size matters!Even a slightly larger enemy can eat you</li><li>As you grow,your view will expand,helping you spot danger from farther away</li><li>Eat<strong>mouse balls</strong>to gain a<strong>dash skill</strong>(âš¡):Dash quickly in your current direction</li><li>Eat<strong>dog balls</strong>to gain a<strong>roar skill</strong>(ðŸš«):Create a red circle that stops enemies from moving for 3 seconds</li><li>Eat<strong>cat balls</strong>to gain a<strong>double score skill</strong>(Ã—2):Double your points for 5 seconds</li><li>Activate skills by clicking the skill button at the bottom or pressing the space bar</li></ul></div><div class="gameCanvasContainer"><canvas id="gameCanvas"></canvas><!--æŠ€èƒ½æŒ‰é’®--><button id="skillButton"style="position: absolute; bottom: 2vh; left: 50%; transform: translateX(-50%); background: #000; color: #fff; border: none; border-radius: 50%; width: 8vw; height: 8vw; font-size: 2vw; cursor: pointer; opacity: 0.3; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; z-index: 20;"><span id="skillIcon">?</span></button></div><div class="leaderboard"style="position: absolute; top: 2vh; right: 2vw; width: 20%; min-width: 15vw; padding: 2vw; background: rgba(255, 255, 255, 0.15); border-radius: 2vw; overflow-y: auto; box-shadow: 0 2vw 10vw rgba(0,0,0,0.1); z-index: 10; font-size: 1.2vw;"><div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5vh;"><h3 style="font-size: 1.8vw; margin: 0;">Leaderboard</h3><button id="toggleLeaderboard"style="background: #000; color: #fff; border: none; border-radius: 5px; padding: 0.5vh 1vw; cursor: pointer; font-size: 1vw;">Hide</button></div><div id="leaderboardList"><!--Leaderboard entries will be dynamically added here--></div></div></div></div><script>const startFishBg=document.querySelector('.startPage .fishBackground');const gameFishBg=document.querySelector('.gameContainer .fishBackground');const startPg=document.querySelector('.startPage');const startBtn=document.querySelector('.startPageButton');const playerNameInput=document.getElementById('playerName');const gameContainer=document.querySelector('.gameContainer');const backBtn=document.querySelector('.backButton');const gameCanvas=document.getElementById('gameCanvas');const leaderboardList=document.getElementById('leaderboardList');const toggleLeaderboard=document.getElementById('toggleLeaderboard');const leaderboardDiv=document.querySelector('.leaderboard');const skillButton=document.getElementById('skillButton');const skillIcon=document.getElementById('skillIcon');let isLeaderboardVisible=true;toggleLeaderboard.addEventListener('click',function(){isLeaderboardVisible=!isLeaderboardVisible;if(isLeaderboardVisible){leaderboardList.style.display='block';toggleLeaderboard.textContent='Hide'}else{leaderboardList.style.display='none';toggleLeaderboard.textContent='Show'}});function setPlayerSkill(skillType){currentSkill=skillType;skillActive=false;skillCooldown=0;updateSkillButton()}function updateSkillButton(){if(currentSkill){skillButton.style.opacity='1';skillButton.style.backgroundColor='#000';if(currentSkill==='dash'){skillIcon.textContent='âš¡'}else if(currentSkill==='roar'){skillIcon.textContent='ðŸš«'}else if(currentSkill==='doubleScore'){skillIcon.textContent='Ã—2'}}else{skillButton.style.opacity='0.3';skillIcon.textContent='?'}}function activateSkill(){if(!currentSkill||skillActive||gameState!=='playing'){return}skillActive=true;if(currentSkill==='dash'){const dashDistance=player.radius*8;if(mouseDirection.x!==0||mouseDirection.y!==0){player.x+=mouseDirection.x*dashDistance;player.y+=mouseDirection.y*dashDistance}else{player.y-=dashDistance}currentSkill=null}else if(currentSkill==='roar'){roarEffectTimer=3*60;currentSkill=null}else if(currentSkill==='doubleScore'){doubleScoreTimer=5*60;currentSkill=null}updateSkillButton()}function updateSkills(){if(doubleScoreTimer>0){doubleScoreTimer--}if(roarEffectTimer>0){roarEffectTimer--;const roarRadius=player.radius*5;for(let i=0;i<enemies.length;i++){const e=enemies[i];const dx=player.x-e.x;const dy=player.y-e.y;const d=Math.sqrt(dx*dx+dy*dy);if(d<roarRadius){if(!e.originalDirection){e.originalDirection={x:e.directionX,y:e.directionY}}e.directionX=0;e.directionY=0}else if(e.originalDirection){e.directionX=e.originalDirection.x;e.directionY=e.originalDirection.y;e.originalDirection=null}}}else if(roarEffectTimer===0){for(let i=0;i<enemies.length;i++){if(enemies[i].originalDirection){enemies[i].directionX=enemies[i].originalDirection.x;enemies[i].directionY=enemies[i].originalDirection.y;enemies[i].originalDirection=null}}}}function drawSkillEffect(){if(roarEffectTimer>0){const roarRadius=player.radius*5;ctx.strokeStyle='rgba(255, 0, 0, '+(roarEffectTimer/180)+')';ctx.lineWidth=player.radius*0.2;ctx.beginPath();ctx.arc(player.x,player.y,roarRadius,0,Math.PI*2);ctx.stroke()}if(doubleScoreTimer>0){ctx.fillStyle='rgba(255, 215, 0, '+(doubleScoreTimer/300)+')';ctx.font=(player.radius*0.8)+'px Arial';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText('Ã—2',player.x,player.y-player.radius*1.5)}}skillButton.addEventListener('click',activateSkill);document.addEventListener('keydown',function(e){if(e.code==='Space'){activateSkill()}});function createFishBg(container){container.innerHTML='';const fishCount=Math.floor(Math.random()*6)+10;for(let i=0;i<fishCount;i++){const fish=document.createElement('div');fish.classList.add('fish');const x=Math.random()*100;const y=Math.random()*100;fish.style.left=x+'%';fish.style.top=y+'%';fish.style.transform=Math.random()>0.5?'scaleX(-1)':'scaleX(1)';container.appendChild(fish);animateFish(fish)}}function animateFish(fish){let x=parseFloat(fish.style.left);let y=parseFloat(fish.style.top);let sx=(Math.random()-0.5)*0.5;let sy=(Math.random()-0.5)*0.2;function move(){x+=sx;y+=sy;if(x<-5){x=-5;sx=Math.abs(sx);fish.style.transform='scaleX(1)'}if(x>105){x=105;sx=-Math.abs(sx);fish.style.transform='scaleX(-1)'}if(y<0||y>100)sy=-sy;if(Math.random()<0.005){sx=(Math.random()-0.5)*0.5;fish.style.transform=sx>0?'scaleX(1)':'scaleX(-1)'}if(Math.random()<0.01){sy=(Math.random()-0.5)*0.2}fish.style.left=x+'%';fish.style.top=y+'%';if(fish.parentElement){requestAnimationFrame(move)}}move()}createFishBg(startFishBg);function setupCanvas(){const container=document.querySelector('.gameCanvasContainer');const rect=container.getBoundingClientRect();const dpr=window.devicePixelRatio||1;const w=rect.width*dpr;const h=rect.height*dpr;gameCanvas.width=w;gameCanvas.height=h;gameCanvas.style.width=rect.width+'px';gameCanvas.style.height=rect.height+'px'}window.addEventListener('resize',()=>{setupCanvas()});function initAudioContext(){if(!audioContext){try{audioContext=new(window.AudioContext||window.webkitAudioContext)()}catch(e){console.log('Web Audio API not supported in this browser')}}}function generatePianoTone(frequency,duration){const b=(i,s,f,x)=>Math.sin((6.28)*(i/s)*f+x);const w=(i,freq)=>Math.sin(6.28*((i/44100)*freq)+b(i,44100,freq,0)**2+(.75*b(i,44100,freq,.25))+(.1*b(i,44100,freq,.5)));const data=[];const sampleRate=44100;const totalSamples=Math.floor(sampleRate*duration);for(let i=0;i<totalSamples;i++){if(i<88){data[i]=(i/(sampleRate*.002))*w(i,frequency)}else{data[i]=(1-((i-(sampleRate*.002))/(sampleRate*(duration-.002))))**((.5*Math.log((frequency*1e4)/44100))**2)*w(i,frequency)}}const buffer=audioContext.createBuffer(1,totalSamples,sampleRate);const channelData=buffer.getChannelData(0);for(let i=0;i<totalSamples;i++){channelData[i]=data[i]}return buffer}function playNote(frequency,duration){if(!audioContext)return;const buffer=generatePianoTone(frequency,duration);const source=audioContext.createBufferSource();const gainNode=audioContext.createGain();source.buffer=buffer;source.connect(gainNode);gainNode.connect(audioContext.destination);gainNode.gain.value=0.1;source.start();if(!backgroundMusic.activeNotes){backgroundMusic.activeNotes=[]}backgroundMusic.activeNotes.push(source);source.onended=function(){const index=backgroundMusic.activeNotes.indexOf(source);if(index>-1){backgroundMusic.activeNotes.splice(index,1)}}}const noteToFrequency={'c':261.63,'c#':277.18,'d':293.66,'d#':311.13,'e':329.63,'f':349.23,'f#':369.99,'g':392.00,'g#':415.30,'a':440.00,'a#':466.16,'b':493.88,'c5':523.25,'c#5':554.37,'d5':587.33,'d#5':622.25,'e5':659.25,'f5':698.46,'f#5':739.99,'g5':783.99,'g#5':830.61,'a5':880.00,'a#5':932.33,'b5':987.77};const gameMelodies={main:[{"note":"d3","duration":1.5},{"note":"d3","duration":1.5},{"note":"e3","duration":1.5},{"note":"f3","duration":1.5},{"note":"f3","duration":1.5},{"note":"g3","duration":1.5},{"note":"a3","duration":1.5},{"note":"g3","duration":1.5},{"note":"a3","duration":1.5},{"note":"f3","duration":1.5},{"note":"e3","duration":1.5},{"note":"f3","duration":1.5},{"note":"e3","duration":1.5},{"note":"d3","duration":1.5},{"note":"d3","duration":1.5},{"note":"e3","duration":1.5},{"note":"f3","duration":1.5},{"note":"a3","duration":1.5},{"note":"c4","duration":1.5},{"note":"d4","duration":1.5},{"note":"e4","duration":1.5},{"note":"c4","duration":1.5},{"note":"b3","duration":1.5},{"note":"c4","duration":1.5},{"note":"b3","duration":1.5},{"note":"a3","duration":1.5},{"note":"a3","duration":1.5},{"note":"c4","duration":1.5},{"note":"d4","duration":1.5},{"note":"e4","duration":1.5},{"note":"c4","duration":1.5},{"note":"b3","duration":1.5},{"note":"a3","duration":1.5},{"note":"g3","duration":1.5},{"note":"a3","duration":1.5},{"note":"d3","duration":1.5},{"note":"a3","duration":1.5},{"note":"g3","duration":1.5},{"note":"f3","duration":1.5},{"note":"e3","duration":1.5},{"note":"d3","duration":1.5},{"note":"g3","duration":1.5},{"note":"a3","duration":1.5},{"note":"g3","duration":1.5},{"note":"g3","duration":1.5},{"note":"f3","duration":1.5},{"note":"e3","duration":1.5},{"note":"f3","duration":1.5},{"note":"e3","duration":1.5},{"note":"d3","duration":1.5},{rest:true,duration:2},],harmony:[]};function createBackgroundMusic(){if(!audioContext){initAudioContext();if(!audioContext)return}if(backgroundMusic){stopBackgroundMusic()}backgroundMusic={activeNotes:[],intervals:[]};function playMelodySequence(melody,delay=0,bpm=180){let noteIndex=0;const beatDuration=60/bpm;setTimeout(()=>{const noteInterval=setInterval(()=>{if(gameState!=='playing'||!musicPlaying){clearInterval(noteInterval);return}if(noteIndex>=melody.length){noteIndex=0}const noteInfo=melody[noteIndex];if(noteInfo.rest){}else if(noteInfo.note){let noteKey=noteInfo.note;let octave=4;const match=noteKey.match(/^([a-g]#?)(\d+)$/i);if(match){noteKey=match[1].toLowerCase();octave=parseInt(match[2])}if(noteToFrequency[noteKey]){let frequency=noteToFrequency[noteKey];if(octave<4){for(let i=0;i<4-octave;i++){frequency/=2}}else if(octave>5){for(let i=0;i<octave-5;i++){frequency*=2}}playNote(frequency,noteInfo.duration)}}noteIndex++},beatDuration*1000);backgroundMusic.intervals.push(noteInterval)},delay)}playMelodySequence(gameMelodies.main,0,120);playMelodySequence(gameMelodies.harmony,0.5*1000,120);musicPlaying=true}function stopBackgroundMusic(updatePlayingState=true){if(backgroundMusic){if(backgroundMusic.intervals&&Array.isArray(backgroundMusic.intervals)){backgroundMusic.intervals.forEach(interval=>clearInterval(interval))}if(backgroundMusic.activeNotes&&Array.isArray(backgroundMusic.activeNotes)){backgroundMusic.activeNotes.forEach(source=>{try{source.stop()}catch(e){}})}backgroundMusic=null;if(updatePlayingState){musicPlaying=false}updateMusicButtonIcon()}}document.addEventListener('click',()=>{if(audioContext&&audioContext.state==='suspended'){audioContext.resume()}},{once:true});document.addEventListener('DOMContentLoaded',()=>{const musicToggle=document.getElementById('musicToggle');if(musicToggle){musicToggle.addEventListener('click',()=>{if(musicPlaying){stopBackgroundMusic()}else{createBackgroundMusic()}updateMusicButtonIcon()})}});function updateMusicButtonIcon(){const musicToggle=document.getElementById('musicToggle');if(musicToggle){musicToggle.textContent=musicPlaying?'ðŸ”Š':'ðŸ”‡'}}let gameState='idle';let playerName='player';let player={x:0,y:0,radius:20,speed:3,color:'#000',isBlackCat:true,name:playerName};let audioContext=null;let musicPlaying=false;let backgroundMusic=null;let currentSkill=null;let skillActive=false;let skillCooldown=0;let doubleScoreTimer=0;let roarEffectTimer=0;let enemies=[];let score=0;let food=[];let ctx;let mouseDirection={x:0,y:0};let isMouseDown=false;const FPS=60;const frameInterval=1000/FPS;let lastFrameTime=0;let animationId=null;function initGame(){ctx=gameCanvas.getContext('2d');setupCanvas();resetGame();gameCanvas.addEventListener('mousedown',handleMouseDown);document.addEventListener('mousemove',handleMouseMove);document.addEventListener('mouseup',handleMouseUp);gameCanvas.addEventListener('touchstart',handleTouchStart);document.addEventListener('touchmove',handleTouchMove);document.addEventListener('touchend',handleTouchEnd)}function handleMouseDown(e){isMouseDown=true;updateMouseDirection(e)}function handleMouseMove(e){if(isMouseDown){updateMouseDirection(e)}}function handleTouchStart(e){e.preventDefault();isMouseDown=true;updateMouseDirection(e.touches[0])}function handleTouchMove(e){e.preventDefault();if(isMouseDown&&e.touches.length>0){updateMouseDirection(e.touches[0])}}function handleTouchEnd(){isMouseDown=false;mouseDirection={x:0,y:0}}function handleMouseUp(){isMouseDown=false;mouseDirection={x:0,y:0}}function updateMouseDirection(e){const rect=gameCanvas.getBoundingClientRect();const canvasX=e.clientX-rect.left;const canvasY=e.clientY-rect.top;const centerX=rect.width/2;const centerY=rect.height/2;mouseDirection.x=canvasX-centerX;mouseDirection.y=canvasY-centerY;const magnitude=Math.sqrt(mouseDirection.x*mouseDirection.x+mouseDirection.y*mouseDirection.y);if(magnitude>0){mouseDirection.x/=magnitude;mouseDirection.y/=magnitude}}function resetGame(){player.x=1000;player.y=1000;player.radius=10;player.name=playerName;score=0;enemies=[];food=[];gameState='playing';currentSkill=null;skillActive=false;skillCooldown=0;doubleScoreTimer=0;roarEffectTimer=0;updateSkillButton();for(let i=0;i<15;i++){spawnEnemy()}for(let i=0;i<200;i++){spawnFood()}}function isPositionValid(x,y,radius){const dxPlayer=x-player.x;const dyPlayer=y-player.y;const distancePlayer=Math.sqrt(dxPlayer*dxPlayer+dyPlayer*dyPlayer);if(distancePlayer<radius+player.radius){return false}for(let i=0;i<enemies.length;i++){const dxEnemy=x-enemies[i].x;const dyEnemy=y-enemies[i].y;const distanceEnemy=Math.sqrt(dxEnemy*dxEnemy+dyEnemy*dyEnemy);if(distanceEnemy<radius+enemies[i].radius){return false}}for(let i=0;i<food.length;i++){const dxFood=x-food[i].x;const dyFood=y-food[i].y;const distanceFood=Math.sqrt(dxFood*dxFood+dyFood*dyFood);if(distanceFood<radius+food[i].radius){return false}}return true}function spawnEnemy(){const types=['dog','mouse','cat'];const type=types[Math.floor(Math.random()*types.length)];const baseRadius=Math.random()*15+5;let enemy;let attempts=0;const maxAttempts=100;do{if(attempts>=maxAttempts){enemy={x:1000,y:1000,radius:baseRadius,speed:(25-baseRadius)*0.1+0.5,directionX:Math.random()*2-1,directionY:Math.random()*2-1,type:type,color:getEnemyColor(type),name:generateRandomName(type)};break}const x=200+Math.random()*1600;const y=200+Math.random()*1600;if(isPositionValid(x,y,baseRadius)){enemy={x:x,y:y,radius:baseRadius,speed:(25-baseRadius)*0.1+0.5,directionX:Math.random()*2-1,directionY:Math.random()*2-1,type:type,color:getEnemyColor(type),name:generateRandomName(type)};break}attempts++}while(true);enemies.push(enemy)}function getEnemyColor(type){if(type==='dog'){return'#8B4513'}else if(type==='mouse'){return'#444444'}else if(type==='cat'){return'#FF69B4'}return'#000000'}function generateRandomName(type){const dogNames=['Rex','Max','Buddy','Rocky','Charlie','Cooper','Duke','Toby','Teddy','Bailey'];const mouseNames=['Jerry','Mickey','Speedy','Squeaky','Nibbles','Scamper','Twitch','Whiskers','Cheese','Peanut'];const catNames=['Felix','Tom','Garfield','Simba','Whiskers','Oliver','Luna','Bella','Chloe','Kitty'];let names;switch(type){case'dog':names=dogNames;break;case'mouse':names=mouseNames;break;case'cat':names=catNames;break;default:names=['Enemy']}return names[Math.floor(Math.random()*names.length)]}function spawnFood(){const radius=Math.random()*2+1;let foodItem;let attempts=0;const maxAttempts=100;do{if(attempts>=maxAttempts){foodItem={x:1000,y:1000,radius:radius,color:'#'+Math.floor(Math.random()*16777215).toString(16)};break}let x,y;if(Math.random()<0.7){const playerRange=500;x=player.x+(Math.random()-0.5)*playerRange;y=player.y+(Math.random()-0.5)*playerRange;x=Math.max(0,Math.min(2000,x));y=Math.max(0,Math.min(2000,y))}else{x=200+Math.random()*1600;y=200+Math.random()*1600}if(isPositionValid(x,y,radius)){foodItem={x:x,y:y,radius:radius,color:'#'+Math.floor(Math.random()*16777215).toString(16)};break}attempts++}while(true);food.push(foodItem)}function gameLoop(timestamp){if(gameState!=='playing')return;if(!lastFrameTime)lastFrameTime=timestamp;const elapsed=timestamp-lastFrameTime;if(elapsed>=frameInterval){lastFrameTime=timestamp-(elapsed%frameInterval);ctx.clearRect(0,0,gameCanvas.width,gameCanvas.height);const baseScale=50;const minScale=0.5;const viewScale=Math.max(minScale,baseScale/(player.radius*0.3+10));ctx.save();ctx.translate(gameCanvas.width/2,gameCanvas.height/2);ctx.scale(viewScale,viewScale);ctx.translate(-player.x,-player.y);ctx.fillStyle='#f0f0f0';ctx.fillRect(0,0,2000,2000);updatePlayer();updateSkills();drawPlayer();drawSkillEffect();updateEnemies();drawEnemies();updateFood();drawFood();checkCollisions();ctx.restore();drawScore();if(Math.random()<0.02){spawnEnemy()}if(Math.random()<0.3){spawnFood()}updateLeaderboard()}animationId=requestAnimationFrame(gameLoop)}function updatePlayer(){if(isMouseDown){const speedFactor=Math.max(0,30-player.radius);const dynamicSpeed=Math.max(1,Math.sqrt(speedFactor)*0.8+1.0);player.x+=mouseDirection.x*dynamicSpeed;player.y+=mouseDirection.y*dynamicSpeed;const mapSize=2000;if(player.x<0)player.x=mapSize;else if(player.x>mapSize)player.x=0;if(player.y<0)player.y=mapSize;else if(player.y>mapSize)player.y=0}}function updateEnemies(){for(let i=enemies.length-1;i>=0;i--){const e=enemies[i];if(!e.target)e.target=null,e.targetUpdateCounter=0;if(e.targetUpdateCounter++>=30){e.targetUpdateCounter=0;e.target=findBestTarget(e)}if(e.target){let targetX,targetY;if(e.target.type==='food'){targetX=e.target.x;targetY=e.target.y}else if(e.target.type==='enemy'||e.target.type==='player'){if(e.target.type==='player'&&e.radius>player.radius*1.1){targetX=player.x;targetY=player.y}else if(e.target.type==='player'&&e.radius<player.radius*1.1){const dxPlayer=player.x-e.x;const dyPlayer=player.y-e.y;targetX=e.x-dxPlayer;targetY=e.y-dyPlayer}else if(e.target.type==='enemy'){if(shouldChase(e,e.target)){targetX=e.target.x;targetY=e.target.y}else{const dx=e.target.x-e.x;const dy=e.target.y-e.y;targetX=e.x-dx;targetY=e.y-dy}}const dx=targetX-e.x;const dy=targetY-e.y;const magnitude=Math.sqrt(dx*dx+dy*dy);if(magnitude>3){e.directionX=dx/magnitude;e.directionY=dy/magnitude}}}else if(Math.random()<0.02){e.directionX=Math.random()*2-1;e.directionY=Math.random()*2-1}const speedFactor=Math.max(0,30-e.radius);const speed=Math.max(1,Math.sqrt(speedFactor)*0.8+1.0);e.x+=e.directionX*speed;e.y+=e.directionY*speed;const mapSize=2000;if(e.x<0)e.x=mapSize;else if(e.x>mapSize)e.x=0;if(e.y<0)e.y=mapSize;else if(e.y>mapSize)e.y=0}}function findBestTarget(e){const detectionRange=200;let bestTarget=null;let highestPriority=-1;for(let i=0;i<food.length;i++){const dx=food[i].x-e.x;const dy=food[i].y-e.y;const distance=Math.sqrt(dx*dx+dy*dy);if(distance<detectionRange&&distance<(bestTarget?Math.sqrt(Math.pow(bestTarget.x-e.x,2)+Math.pow(bestTarget.y-e.y,2)):Infinity)){bestTarget={x:food[i].x,y:food[i].y,type:'food',index:i};highestPriority=3}}for(let i=0;i<enemies.length;i++){const otherEnemy=enemies[i];if(e===otherEnemy)continue;const dx=otherEnemy.x-e.x;const dy=otherEnemy.y-e.y;const distance=Math.sqrt(dx*dx+dy*dy);if(distance<detectionRange){if(shouldAvoid(e,otherEnemy)){if(highestPriority<4){bestTarget={x:otherEnemy.x,y:otherEnemy.y,type:'enemy',enemy:otherEnemy};highestPriority=4}}else if(shouldChase(e,otherEnemy)&&distance<(bestTarget?Math.sqrt(Math.pow(bestTarget.x-e.x,2)+Math.pow(bestTarget.y-e.y,2)):Infinity)){if(highestPriority<2){bestTarget={x:otherEnemy.x,y:otherEnemy.y,type:'enemy',enemy:otherEnemy};highestPriority=2}}}}const dxPlayer=player.x-e.x;const dyPlayer=player.y-e.y;const distancePlayer=Math.sqrt(dxPlayer*dxPlayer+dyPlayer*dyPlayer);if(distancePlayer<detectionRange){if(player.radius>e.radius*1.1){if(highestPriority<4){bestTarget={type:'player'};highestPriority=4}}else if(e.radius>player.radius*1.1){if(highestPriority<2){bestTarget={type:'player'};highestPriority=2}}}return bestTarget}function shouldChase(e,otherEnemy){if(e.radius<=otherEnemy.radius*1.1)return false;if(e.type==='mouse')return otherEnemy.type==='dog';else if(e.type==='cat')return otherEnemy.type==='mouse';else if(e.type==='dog')return otherEnemy.type==='cat';return false}function shouldAvoid(e,otherEnemy){if(e.radius>otherEnemy.radius*1.1)return false;if(e.type==='mouse')return otherEnemy.type==='cat';else if(e.type==='cat')return otherEnemy.type==='dog';else if(e.type==='dog')return otherEnemy.type==='mouse';return false}function updateFood(){while(food.length<200){spawnFood()}}function checkCollisions(){if(player.radius>1000){gameWin();return}for(let i=food.length-1;i>=0;i--){const dx=player.x-food[i].x;const dy=player.y-food[i].y;const d=Math.sqrt(dx*dx+dy*dy);if(d<player.radius){food.splice(i,1);if(doubleScoreTimer>0){score+=2}else{score++}player.radius=Math.sqrt(player.radius*player.radius+0.5)}}for(let i=enemies.length-1;i>=0;i--){const e=enemies[i];for(let j=food.length-1;j>=0;j--){const dx=e.x-food[j].x;const dy=e.y-food[j].y;const d=Math.sqrt(dx*dx+dy*dy);if(d<e.radius){food.splice(j,1);e.radius=Math.sqrt(e.radius*e.radius+0.5)}}}for(let i=enemies.length-1;i>=0;i--){const e=enemies[i];const dx=player.x-e.x;const dy=player.y-e.y;const d=Math.sqrt(dx*dx+dy*dy);if(d<player.radius+e.radius){if(player.radius>e.radius*1.1){enemies.splice(i,1);const pointsEarned=Math.floor(e.radius*2);if(doubleScoreTimer>0){score+=pointsEarned*2}else{score+=pointsEarned}player.radius=Math.sqrt(player.radius*player.radius+e.radius*e.radius*0.5);if(e.type==='mouse'){setPlayerSkill('dash')}else if(e.type==='dog'){setPlayerSkill('roar')}else if(e.type==='cat'){setPlayerSkill('doubleScore')}}else if(e.radius>player.radius*1.1){gameOver();return}else{const angle=Math.atan2(dy,dx);const pushDistance=(player.radius+e.radius-d)*0.5;player.x+=Math.cos(angle)*pushDistance;player.y+=Math.sin(angle)*pushDistance;e.x-=Math.cos(angle)*pushDistance;e.y-=Math.sin(angle)*pushDistance}}}for(let i=0;i<enemies.length;i++){for(let j=i+1;j<enemies.length;j++){const e1=enemies[i];const e2=enemies[j];const dx=e1.x-e2.x;const dy=e1.y-e2.y;const d=Math.sqrt(dx*dx+dy*dy);if(d<e1.radius+e2.radius){if(e1.radius>e2.radius*1.1){e1.radius=Math.sqrt(e1.radius*e1.radius+e2.radius*e2.radius*0.5);enemies.splice(j,1);j--}else if(e2.radius>e1.radius*1.1){e2.radius=Math.sqrt(e2.radius*e2.radius+e1.radius*e1.radius*0.5);enemies.splice(i,1);i--;break}else{const angle=Math.atan2(dy,dx);const pushDistance=(e1.radius+e2.radius-d)*0.5;e1.x+=Math.cos(angle)*pushDistance;e1.y+=Math.sin(angle)*pushDistance;e2.x-=Math.cos(angle)*pushDistance;e2.y-=Math.sin(angle)*pushDistance}}}}}function updateLeaderboard(){if(!leaderboardList)return;let leaderboardData=[];leaderboardData.push({name:player.name,size:player.radius,isPlayer:true,color:player.color});for(let i=0;i<enemies.length;i++){leaderboardData.push({name:enemies[i].name,size:enemies[i].radius,isPlayer:false,color:enemies[i].color})}leaderboardData.sort((a,b)=>b.size-a.size);leaderboardList.innerHTML='';const maxEntries=Math.min(10,leaderboardData.length);for(let i=0;i<maxEntries;i++){const entry=leaderboardData[i];const entryElement=document.createElement('div');entryElement.style.display='flex';entryElement.style.alignItems='center';entryElement.style.marginBottom='1vh';entryElement.style.padding='0.5vh';entryElement.style.borderRadius='5px';entryElement.style.background=i<3?'rgba(240, 240, 240, 0.7)':'transparent';const rankElement=document.createElement('div');rankElement.textContent=(i+1)+'.';rankElement.style.width='2vw';rankElement.style.fontWeight='bold';rankElement.style.marginRight='1vw';const colorIndicator=document.createElement('div');colorIndicator.style.width='1vw';colorIndicator.style.height='1vw';colorIndicator.style.borderRadius='50%';colorIndicator.style.backgroundColor=entry.color;colorIndicator.style.marginRight='1vw';const infoElement=document.createElement('div');infoElement.style.flex='1';const nameElement=document.createElement('span');nameElement.textContent=entry.name;nameElement.style.fontWeight='bold';nameElement.style.color=entry.isPlayer?'blue':'black';const sizeElement=document.createElement('span');sizeElement.textContent=' - Size: '+Math.round(entry.size);sizeElement.style.marginLeft='0.5vw';infoElement.appendChild(nameElement);infoElement.appendChild(sizeElement);entryElement.appendChild(rankElement);entryElement.appendChild(colorIndicator);entryElement.appendChild(infoElement);leaderboardList.appendChild(entryElement)}}function gameOver(){gameState='gameOver';if(animationId){cancelAnimationFrame(animationId);animationId=null}ctx.save();ctx.setTransform(1,0,0,1,0,0);ctx.fillStyle='rgba(255, 255, 255, 0.9)';ctx.fillRect(0,0,gameCanvas.width,gameCanvas.height);ctx.fillStyle='#000';ctx.font='30px Arial';ctx.textAlign='center';ctx.fillText('Game Over',gameCanvas.width/2,gameCanvas.height/2-20);ctx.font='20px Arial';ctx.fillText('Your Score: '+score,gameCanvas.width/2,gameCanvas.height/2+20);ctx.fillText('Click to play again',gameCanvas.width/2,gameCanvas.height/2+60);ctx.restore();gameCanvas.addEventListener('click',restartGame)}function gameWin(){gameState='gameWin';if(animationId){cancelAnimationFrame(animationId);animationId=null}ctx.save();ctx.setTransform(1,0,0,1,0,0);ctx.fillStyle='rgba(255, 255, 255, 0.9)';ctx.fillRect(0,0,gameCanvas.width,gameCanvas.height);ctx.fillStyle='#000';ctx.font='30px Arial';ctx.textAlign='center';ctx.fillText('Congratulations! You Won!',gameCanvas.width/2,gameCanvas.height/2-40);ctx.fillText('You have eaten everything!',gameCanvas.width/2,gameCanvas.height/2-10);ctx.font='20px Arial';ctx.fillText('Final Score: '+score,gameCanvas.width/2,gameCanvas.height/2+30);ctx.fillText('Final Size: '+Math.round(player.radius),gameCanvas.width/2,gameCanvas.height/2+60);ctx.fillText('Click to play again',gameCanvas.width/2,gameCanvas.height/2+100);ctx.restore();gameCanvas.addEventListener('click',restartGame)}function restartGame(){if(gameState==='gameOver'||gameState==='gameWin'){gameCanvas.removeEventListener('click',restartGame);resetGame();gameLoop();stopBackgroundMusic(false);createBackgroundMusic()}}function drawPlayer(){ctx.fillStyle=player.color;ctx.beginPath();ctx.arc(player.x,player.y,player.radius,0,Math.PI*2);ctx.fill();if(isMouseDown&&(mouseDirection.x!==0||mouseDirection.y!==0)){const arrowLength=player.radius*1.5;const arrowX=player.x+mouseDirection.x*arrowLength;const arrowY=player.y+mouseDirection.y*arrowLength;ctx.strokeStyle='red';ctx.lineWidth=player.radius*0.1;ctx.beginPath();ctx.moveTo(player.x,player.y);ctx.lineTo(arrowX,arrowY);ctx.stroke();const angle=Math.atan2(mouseDirection.y,mouseDirection.x);const headLength=player.radius*0.4;const headAngle=Math.PI/6;ctx.fillStyle='red';ctx.beginPath();ctx.moveTo(arrowX,arrowY);ctx.lineTo(arrowX-headLength*Math.cos(angle-headAngle),arrowY-headLength*Math.sin(angle-headAngle));const arrowBaseLength=player.radius*0.2;const baseX=arrowX-arrowBaseLength*Math.cos(angle);const baseY=arrowY-arrowBaseLength*Math.sin(angle);ctx.lineTo(baseX,baseY);ctx.lineTo(arrowX-headLength*Math.cos(angle+headAngle),arrowY-headLength*Math.sin(angle+headAngle));ctx.closePath();ctx.fill()}ctx.fillStyle=player.color;const earHeight=player.radius*0.6;const earWidth=player.radius*0.3;ctx.beginPath();ctx.moveTo(player.x-player.radius*0.3,player.y-player.radius);ctx.lineTo(player.x-player.radius*0.7,player.y-player.radius-earHeight);ctx.lineTo(player.x-player.radius*0.1,player.y-player.radius-earHeight*0.3);ctx.closePath();ctx.fill();ctx.beginPath();ctx.moveTo(player.x+player.radius*0.3,player.y-player.radius);ctx.lineTo(player.x+player.radius*0.7,player.y-player.radius-earHeight);ctx.lineTo(player.x+player.radius*0.1,player.y-player.radius-earHeight*0.3);ctx.closePath();ctx.fill();ctx.fillStyle='white';const eyeSize=player.radius*0.15;const eyeOffset=player.radius*0.35;ctx.beginPath();ctx.arc(player.x-eyeOffset,player.y-eyeOffset/2,eyeSize,0,Math.PI*2);ctx.arc(player.x+eyeOffset,player.y-eyeOffset/2,eyeSize,0,Math.PI*2);ctx.fill();ctx.fillStyle='black';const pupilSize=eyeSize*0.5;ctx.beginPath();ctx.arc(player.x-eyeOffset+player.radius*0.03,player.y-eyeOffset/2,pupilSize,0,Math.PI*2);ctx.arc(player.x+eyeOffset+player.radius*0.03,player.y-eyeOffset/2,pupilSize,0,Math.PI*2);ctx.fill();ctx.strokeStyle='white';ctx.lineWidth=player.radius*0.05;ctx.beginPath();ctx.moveTo(player.x-player.radius*0.2,player.y+player.radius*0.1);ctx.quadraticCurveTo(player.x,player.y+player.radius*0.25,player.x+player.radius*0.2,player.y+player.radius*0.1);ctx.moveTo(player.x-player.radius*0.15,player.y+player.radius*0.1);ctx.quadraticCurveTo(player.x,player.y+player.radius*0.2,player.x+player.radius*0.15,player.y+player.radius*0.1);ctx.stroke();ctx.strokeStyle='white';ctx.lineWidth=player.radius*0.03;ctx.beginPath();ctx.moveTo(player.x-player.radius*0.4,player.y+player.radius*0.05);ctx.lineTo(player.x-player.radius*0.7,player.y-player.radius*0.05);ctx.moveTo(player.x-player.radius*0.4,player.y+player.radius*0.1);ctx.lineTo(player.x-player.radius*0.7,player.y+player.radius*0.1);ctx.moveTo(player.x-player.radius*0.4,player.y+player.radius*0.15);ctx.lineTo(player.x-player.radius*0.7,player.y+player.radius*0.25);ctx.moveTo(player.x+player.radius*0.4,player.y+player.radius*0.05);ctx.lineTo(player.x+player.radius*0.7,player.y-player.radius*0.05);ctx.moveTo(player.x+player.radius*0.4,player.y+player.radius*0.1);ctx.lineTo(player.x+player.radius*0.7,player.y+player.radius*0.1);ctx.moveTo(player.x+player.radius*0.4,player.y+player.radius*0.15);ctx.lineTo(player.x+player.radius*0.7,player.y+player.radius*0.25);ctx.stroke();ctx.fillStyle='rgba(0, 0, 0, 0.7)';ctx.font=(player.radius*0.4)+'px Arial';ctx.textAlign='center';ctx.textBaseline='top';ctx.fillText(player.name,player.x,player.y-player.radius-player.radius*0.8)}function drawEnemies(){for(let i=0;i<enemies.length;i++){const enemy=enemies[i];ctx.fillStyle=enemy.color;ctx.beginPath();ctx.arc(enemy.x,enemy.y,enemy.radius,0,Math.PI*2);ctx.fill();ctx.fillStyle='white';if(enemy.type==='dog'){const earSize=enemy.radius*0.3;ctx.beginPath();ctx.moveTo(enemy.x-enemy.radius*0.5,enemy.y-enemy.radius);ctx.lineTo(enemy.x-enemy.radius*0.8,enemy.y-enemy.radius-earSize);ctx.lineTo(enemy.x-enemy.radius*0.2,enemy.y-enemy.radius-earSize*0.5);ctx.closePath();ctx.fill();ctx.beginPath();ctx.moveTo(enemy.x+enemy.radius*0.5,enemy.y-enemy.radius);ctx.lineTo(enemy.x+enemy.radius*0.8,enemy.y-enemy.radius-earSize);ctx.lineTo(enemy.x+enemy.radius*0.2,enemy.y-enemy.radius-earSize*0.5);ctx.closePath();ctx.fill();const eyeSize=enemy.radius*0.15;const eyeOffset=enemy.radius*0.4;ctx.beginPath();ctx.arc(enemy.x-eyeOffset,enemy.y-eyeOffset/2,eyeSize,0,Math.PI*2);ctx.arc(enemy.x+eyeOffset,enemy.y-eyeOffset/2,eyeSize,0,Math.PI*2);ctx.fill();ctx.fillStyle='black';ctx.beginPath();ctx.arc(enemy.x,enemy.y,eyeSize,0,Math.PI*2);ctx.fill()}else if(enemy.type==='mouse'){const earSize=enemy.radius*0.3;ctx.beginPath();ctx.arc(enemy.x-enemy.radius*0.5,enemy.y-enemy.radius*0.8,earSize,0,Math.PI*2);ctx.arc(enemy.x+enemy.radius*0.5,enemy.y-enemy.radius*0.8,earSize,0,Math.PI*2);ctx.fill();const eyeSize=enemy.radius*0.15;const eyeOffset=enemy.radius*0.4;ctx.beginPath();ctx.arc(enemy.x-eyeOffset,enemy.y-eyeOffset/4,eyeSize,0,Math.PI*2);ctx.arc(enemy.x+eyeOffset,enemy.y-eyeOffset/4,eyeSize,0,Math.PI*2);ctx.fill();ctx.fillStyle='pink';ctx.beginPath();ctx.arc(enemy.x,enemy.y+enemy.radius*0.2,eyeSize*0.8,0,Math.PI*2);ctx.fill()}else if(enemy.type==='cat'){const earSize=enemy.radius*0.4;ctx.beginPath();ctx.moveTo(enemy.x-enemy.radius*0.5,enemy.y-enemy.radius);ctx.lineTo(enemy.x-enemy.radius*0.7,enemy.y-enemy.radius-earSize);ctx.lineTo(enemy.x-enemy.radius*0.3,enemy.y-enemy.radius);ctx.closePath();ctx.fill();ctx.beginPath();ctx.moveTo(enemy.x+enemy.radius*0.5,enemy.y-enemy.radius);ctx.lineTo(enemy.x+enemy.radius*0.7,enemy.y-enemy.radius-earSize);ctx.lineTo(enemy.x+enemy.radius*0.3,enemy.y-enemy.radius);ctx.closePath();ctx.fill();const eyeSize=enemy.radius*0.15;const eyeOffset=enemy.radius*0.4;ctx.beginPath();ctx.arc(enemy.x-eyeOffset,enemy.y-eyeOffset/2,eyeSize,0,Math.PI*2);ctx.arc(enemy.x+eyeOffset,enemy.y-eyeOffset/2,eyeSize,0,Math.PI*2);ctx.fill();ctx.strokeStyle='white';ctx.lineWidth=enemy.radius*0.03;ctx.beginPath();ctx.moveTo(enemy.x-enemy.radius*0.6,enemy.y+enemy.radius*0.1);ctx.lineTo(enemy.x-enemy.radius*0.3,enemy.y+enemy.radius*0.05);ctx.moveTo(enemy.x-enemy.radius*0.6,enemy.y+enemy.radius*0.2);ctx.lineTo(enemy.x-enemy.radius*0.3,enemy.y+enemy.radius*0.2);ctx.moveTo(enemy.x+enemy.radius*0.3,enemy.y+enemy.radius*0.05);ctx.lineTo(enemy.x+enemy.radius*0.6,enemy.y+enemy.radius*0.1);ctx.moveTo(enemy.x+enemy.radius*0.3,enemy.y+enemy.radius*0.2);ctx.lineTo(enemy.x+enemy.radius*0.6,enemy.y+enemy.radius*0.2);ctx.stroke()}ctx.fillStyle='black';const pupilSize=enemy.radius*0.08;ctx.beginPath();ctx.arc(enemy.x-enemy.radius*0.4,enemy.y-enemy.radius*0.2,pupilSize,0,Math.PI*2);ctx.arc(enemy.x+enemy.radius*0.4,enemy.y-enemy.radius*0.2,pupilSize,0,Math.PI*2);ctx.fill();ctx.fillStyle='rgba(0, 0, 0, 0.7)';ctx.font=(enemy.radius*0.4)+'px Arial';ctx.textAlign='center';ctx.textBaseline='top';ctx.fillText(enemy.name,enemy.x,enemy.y-enemy.radius-enemy.radius*0.6)}}function drawFood(){for(let i=0;i<food.length;i++){ctx.fillStyle=food[i].color;ctx.beginPath();ctx.arc(food[i].x,food[i].y,food[i].radius,0,Math.PI*2);ctx.fill()}}function drawScore(){ctx.fillStyle='#000';ctx.font='20px Arial';ctx.textAlign='left';ctx.fillText('Score: '+score,20,30);ctx.fillText('Size: '+Math.round(player.radius),20,60);ctx.fillText('View: '+Math.round((player.radius/10)*100)+'%',20,90)}startBtn.addEventListener('click',()=>{playerName=playerNameInput.value.trim()||'player';gameContainer.classList.add('show');setupCanvas();createFishBg(gameFishBg);if(gameState==='idle'){initGame()}resetGame();lastFrameTime=0;if(animationId){cancelAnimationFrame(animationId)}animationId=requestAnimationFrame(gameLoop);musicPlaying=true;createBackgroundMusic()});backBtn.addEventListener('click',()=>{gameContainer.classList.remove('show');stopBackgroundMusic();gameState='idle';if(animationId){cancelAnimationFrame(animationId);animationId=null}stopBackgroundMusic()});function cleanupGame(){gameCanvas.removeEventListener('mousedown',handleMouseDown);document.removeEventListener('mousemove',handleMouseMove);document.removeEventListener('mouseup',handleMouseUp);gameCanvas.removeEventListener('touchstart',handleTouchStart);document.removeEventListener('touchmove',handleTouchMove);document.removeEventListener('touchend',handleTouchEnd);if(animationId){cancelAnimationFrame(animationId);animationId=null}stopBackgroundMusic()}</script></body></html>